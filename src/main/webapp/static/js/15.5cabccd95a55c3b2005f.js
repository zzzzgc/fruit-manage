webpackJsonp([15],{FAWF:function(e,t,r){"use strict";function o(e){r("uFyX"),r("wtPX")}Object.defineProperty(t,"__esModule",{value:!0});var a=r("Rtm0"),s=r("jyyh"),i=r("OF7X"),l=o,u=i(a.a,s.a,!1,l,"data-v-19e4a630",null);t.default=u.exports},Rtm0:function(e,t,r){"use strict";var o=r("HzJ8"),a=r.n(o),s=r("aA9S"),i=r.n(s),l=r("4YfN"),u=r.n(l),d=r("g7ZD"),n=r("JaHG"),c=r("+UIE"),p=r("9rMa");t.a={name:"productAddOrEdit",props:["showDialog","editRowId"],mounted:function(){this.getTypes(),this.show()},data:function(){return{isAddKeywordsShow:!1,addKeywords:"",resetForm:{id:"",name:"",types:[],fruit_type:"",keywords:[],produceArea:[],sort:999,brand:"",recommendTypes:[],measure_unit:"",status:1,fresh_time:"",fruit_des:"",store_way:"",imgs:[]},product:{},rules:{name:[{required:!0,message:"请输入商品名",trigger:"blur"},{min:2,max:50,message:"长度在 2 到50 个字符之间"}],types:[{type:"array",required:!0,message:"请至少选择一个分类名",trigger:"blur,change"}],keywords:[{type:"array",required:!0,message:"请至少添加一个关键字",trigger:"blur,change"}],produceArea:[{type:"array",required:!0,message:"请选择产地",trigger:"blur,change"}],measure_unit:[{required:!0,message:"请选择销售单位",trigger:"blur,change"}],status:[{type:"number",required:!0,message:"请选择是否上架",trigger:"blur,change"}]}}},computed:Object(p.c)({productStore:"product"}),methods:u()({deleteKeywords:function(e){this.product.keywords.splice(this.product.keywords.indexOf(e),1)},handleKeywordsConfirm:function(){var e=this.addKeywords;e&&this.product.keywords.push(e),this.isAddKeywordsShow=!1,this.addKeywords=""},showAddKeywords:function(){var e=this;this.isAddKeywordsShow=!0,this.$nextTick(function(t){e.$refs.addKeywordsInput.$refs.input.focus()})},handleRemoveImg:function(e,t){this._imgUploadChange(t)},reset:function(){this.$refs.form&&this.$refs.form.resetFields(),this.product=i()({},this.resetForm)}},Object(p.b)({getTypes:c.f}),{show:function(){var e=this;this.reset(),null!==this.editRowId&&this.$http.post("/product/info",{id:this.editRowId},{showLoading:!0}).then(function(t){var r=[],o=!0,s=!1,l=void 0;try{for(var u,d=a()(t.data.imgs);!(o=(u=d.next()).done);o=!0){var c=u.value;r.push({url:c.img_url})}}catch(e){s=!0,l=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw l}}delete t.data.imgs;var p=[];t.data.country&&null!==t.data.country&&p.push(t.data.country),delete t.data.country,t.data.province&&null!==t.data.province&&p.push(t.data.province),delete t.data.province,e.product=i()({},Object(n.c)(t.data),{imgs:r,produceArea:p})}).catch(function(){e.$emit("update:showDialog",!1)})},handleAvatarScucess:function(e,t,r){e?this._imgUploadChange(r):this.$message.error("该图片不支持上传，请更换一张！")},beforeAvatarUpload:function(e){var t=0===e.type.indexOf("image/");t||this.$message.error("上传图标必须为图片格式!");var r=e.size/1024/1024<5;return r||this.$message.error("上传图标大小不能超过 5MB!"),r&&t},_imgUploadChange:function(e){this.product.imgs=[];var t=!0,r=!1,o=void 0;try{for(var s,i=a()(e);!(t=(s=i.next()).done);t=!0){var l=s.value;this.product.imgs.push({url:l.response||l.url})}}catch(e){r=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw o}}},onSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var r={};e.product.produceArea.length>0&&(r.country=e.product.produceArea[0]),e.product.produceArea.length>1&&(r.province=e.product.produceArea[1]);var o=[],s=!0,l=!1,u=void 0;try{for(var n,c=a()(e.product.imgs);!(s=(n=c.next()).done);s=!0){var p=n.value;o.push(p.url)}}catch(e){l=!0,u=e}finally{try{!s&&c.return&&c.return()}finally{if(l)throw u}}var m=i()(e.resetForm,e.product,r,{imgs:o});delete m.produceArea,e.$http.post("/product/save",m,{showLoading:!0}).then(function(t){e.$emit("update:showDialog",!1),""!==e.product.id?(e.$message({type:"success",message:"编辑数据成功"}),d.b.$emit(d.d.edit,m)):(e.$message({type:"success",message:"添加数据成功"}),d.b.$emit(d.d.add,m))})})}})}},jyyh:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"商品添加/编辑",visible:e.showDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$emit("update:showDialog",t)},open:e.show,close:e.reset}},[r("el-form",{ref:"form",staticClass:"form-style",attrs:{model:e.product,rules:e.rules,"label-width":"100px","label-position":"right"}},[null!==this.editRowId?r("el-form-item",{attrs:{label:"商品ID",prop:"id"}},[e._v(e._s(e.product.id))]):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"商品名",prop:"name"}},[r("el-input",{model:{value:e.product.name,callback:function(t){e.$set(e.product,"name",t)},expression:"product.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"分类名",prop:"types"}},[r("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.product.types,callback:function(t){e.$set(e.product,"types",t)},expression:"product.types"}},e._l(e.productStore.typeList,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"植物属类",prop:"fruit_type"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.product.fruit_type,callback:function(t){e.$set(e.product,"fruit_type",t)},expression:"product.fruit_type"}},e._l(e.productStore.fruitTypeList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"搜索关键字",prop:"keywords"}},[e._l(e.product.keywords,function(t){return r("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1},on:{close:function(r){e.deleteKeywords(t)}}},[e._v(e._s(t))])}),e._v(" "),e.isAddKeywordsShow?r("el-input",{ref:"addKeywordsInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleKeywordsConfirm},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.handleKeywordsConfirm(t)}},model:{value:e.addKeywords,callback:function(t){e.addKeywords=t},expression:"addKeywords"}}):r("el-button",{attrs:{size:"small"},on:{click:e.showAddKeywords}},[e._v("+ New Tag")])],2),e._v(" "),r("el-form-item",{attrs:{label:"产地",prop:"produceArea"}},[r("el-cascader",{attrs:{placeholder:"请选择产地",options:e.productStore.productionInfoList,filterable:"","change-on-select":""},model:{value:e.product.produceArea,callback:function(t){e.$set(e.product,"produceArea",t)},expression:"product.produceArea"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"显示顺序",prop:"sort"}},[r("el-input-number",{attrs:{min:1,max:9999999},model:{value:e.product.sort,callback:function(t){e.$set(e.product,"sort",t)},expression:"product.sort"}}),e._v(" "),r("span",[e._v("越大越靠前")])],1),e._v(" "),r("el-form-item",{attrs:{label:"品牌",prop:"brand"}},[r("el-input",{model:{value:e.product.brand,callback:function(t){e.$set(e.product,"brand",t)},expression:"product.brand"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"标签",prop:"recommendTypes"}},[r("el-checkbox-group",{model:{value:e.product.recommendTypes,callback:function(t){e.$set(e.product,"recommendTypes",t)},expression:"product.recommendTypes"}},e._l(e.productStore.recommendList,function(t){return r("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),r("el-form-item",{attrs:{label:"销售单位",prop:"measure_unit"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.product.measure_unit,callback:function(t){e.$set(e.product,"measure_unit",t)},expression:"product.measure_unit"}},e._l(e.productStore.measureUnitList,function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"上架",prop:"status"}},[r("el-radio-group",{model:{value:e.product.status,callback:function(t){e.$set(e.product,"status",t)},expression:"product.status"}},[r("el-radio",{attrs:{label:1}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"保鲜期",prop:"fresh_time"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.product.fresh_time,callback:function(t){e.$set(e.product,"fresh_time",t)},expression:"product.fresh_time"}},e._l(e.productStore.freshMinuteList,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"果品特征",prop:"fruit_des"}},[r("el-input",{model:{value:e.product.fruit_des,callback:function(t){e.$set(e.product,"fruit_des",t)},expression:"product.fruit_des"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"保藏方法",prop:"store_way"}},[r("el-input",{model:{value:e.product.store_way,callback:function(t){e.$set(e.product,"store_way",t)},expression:"product.store_way"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"图片",prop:"imgs"}},[r("el-upload",{attrs:{action:e._uploadFilePath,"list-type":"picture-card",limit:20,"file-list":e.product.imgs,"on-remove":e.handleRemoveImg,"on-success":e.handleAvatarScucess,"before-upload":e.beforeAvatarUpload}},[r("i",{staticClass:"el-icon-plus"})])],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.$emit("update:showDialog",!1)}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)},a=[],s={render:o,staticRenderFns:a};t.a=s},"r/d9":function(e,t,r){t=e.exports=r("BkJT")(!1),t.push([e.i,".el-cascader,.el-select{width:100%}.input-new-tag.el-input{width:auto}span.el-tag{margin-right:10px}.el-upload--picture-card,.el-upload-list--picture-card .el-upload-list__item{width:150px;height:150px}.el-upload--picture-card{line-height:150px}",""])},rMc2:function(e,t,r){t=e.exports=r("BkJT")(!1),t.push([e.i,".avatar-uploader-icon[data-v-19e4a630]{font-size:15px;border:1px solid #bfcbd9;padding:14px 17px;border-radius:5px}.avatar-img[data-v-19e4a630]{max-width:60px}",""])},uFyX:function(e,t,r){var o=r("rMc2");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);r("8bSs")("98c160f4",o,!0)},wtPX:function(e,t,r){var o=r("r/d9");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);r("8bSs")("b5c5b230",o,!0)}});