webpackJsonp([37],{"+apA":function(s,e,t){var i=t("k1I7");"string"==typeof i&&(i=[[s.i,i,""]]),i.locals&&(s.exports=i.locals);t("rjj0")("361bedc7",i,!0)},H0F9:function(s,e,t){"use strict";function i(s){t("xg1Q"),t("+apA")}Object.defineProperty(e,"__esModule",{value:!0});var n=t("bRJ/"),a=t("NF4Y"),r=t("VU/8"),o=i,l=r(n.a,a.a,!1,o,"data-v-0f8c4efc",null);e.default=l.exports},Kp6b:function(s,e,t){e=s.exports=t("FZ+f")(!1),e.push([s.i,".avatar-uploader-icon[data-v-0f8c4efc]{font-size:15px;border:1px solid #bfcbd9;padding:14px 17px;border-radius:5px}.avatar-img[data-v-0f8c4efc]{max-width:60px}",""])},NF4Y:function(s,e,t){"use strict";var i=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("el-dialog",{attrs:{title:"客户添加/编辑",visible:s.showDialog,"close-on-click-modal":!1},on:{"update:visible":function(e){return s.$emit("update:showDialog",e)},open:s.show,close:s.reset}},[t("el-form",{ref:"form",staticClass:"form-style",attrs:{model:s.businessInfo,rules:s.rules,"label-width":"100px","label-position":"right"}},[null!==this.editRowId?t("el-form-item",{attrs:{label:"店铺ID",prop:"id"}},[s._v(s._s(s.businessInfo.id))]):s._e(),s._v(" "),t("el-form-item",{attrs:{label:"店铺名称",prop:"business_name"}},[t("el-input",{attrs:{placeholder:"所在城市+店名，如广州嘻果"},model:{value:s.businessInfo.business_name,callback:function(e){s.$set(s.businessInfo,"business_name",e)},expression:"businessInfo.business_name"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"联系人",prop:"business_contacts"}},[t("el-input",{model:{value:s.businessInfo.business_contacts,callback:function(e){s.$set(s.businessInfo,"business_contacts",e)},expression:"businessInfo.business_contacts"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"联系电话",prop:"phone"}},[t("el-input",{model:{value:s.businessInfo.phone,callback:function(e){s.$set(s.businessInfo,"phone",e)},expression:"businessInfo.phone"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"法人姓名",prop:"legal_person_name"}},[t("el-input",{model:{value:s.businessAuth.legal_person_name,callback:function(e){s.$set(s.businessAuth,"legal_person_name",e)},expression:"businessAuth.legal_person_name"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"省 市",prop:"provinceAndCityArray"}},[t("el-cascader",{attrs:{options:s.provinceAndCityData},on:{change:s.handleChangePriovinceAndCityData},model:{value:s.provinceAndCityArray,callback:function(e){s.provinceAndCityArray=e},expression:"provinceAndCityArray"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"收货地址",prop:"address_detail"}},[t("el-input",{model:{value:s.businessInfo.address_detail,callback:function(e){s.$set(s.businessInfo,"address_detail",e)},expression:"businessInfo.address_detail"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"店铺地址",prop:"address_shop"}},[t("el-input",{attrs:{placeholder:"若与收货地址一致，则无需填写"},model:{value:s.businessInfo.address_shop,callback:function(e){s.$set(s.businessInfo,"address_shop",e)},expression:"businessInfo.address_shop"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"物流方式",prop:"shipments_type"}},[t("el-radio-group",{model:{value:s.businessInfo.shipments_type,callback:function(e){s.$set(s.businessInfo,"shipments_type",e)},expression:"businessInfo.shipments_type"}},[t("el-radio",{attrs:{label:0}},[s._v("市场车")]),s._v(" "),t("el-radio",{attrs:{label:1}},[s._v("物流")]),s._v(" "),t("el-radio",{attrs:{label:2}},[s._v("自提")])],1)],1),s._v(" "),t("el-form-item",{attrs:{label:"销售",prop:"saleUserId"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:s.saleUser.saleUserId,callback:function(e){s.$set(s.saleUser,"saleUserId",e)},expression:"saleUser.saleUserId"}},s._l(s.allSaleUserInfo,function(s){return t("el-option",{key:s.id,attrs:{label:s.nick_name+"/"+s.phone,value:s.id}})}))],1),s._v(" "),t("el-form-item",{attrs:{label:"法人身份证",prop:"identity"}},[t("el-input",{model:{value:s.businessAuth.identity,callback:function(e){s.$set(s.businessAuth,"identity",e)},expression:"businessAuth.identity"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"银行卡账号",prop:"name"}},[t("el-input",{model:{value:s.businessAuth.bank_account,callback:function(e){s.$set(s.businessAuth,"bank_account",e)},expression:"businessAuth.bank_account"}})],1),s._v(" "),t("el-form-item",{attrs:{label:"认证类型",prop:"auth_type"}},[t("el-radio-group",{model:{value:s.businessAuth.auth_type,callback:function(e){s.$set(s.businessAuth,"auth_type",e)},expression:"businessAuth.auth_type"}},[t("el-radio",{attrs:{label:"1"}},[s._v("实体店认证")]),s._v(" "),t("el-radio",{attrs:{label:"2"}},[s._v("网络认证")])],1)],1),s._v(" "),"1"==this.businessAuth.auth_type?t("el-form-item",{attrs:{label:"营业执照号",prop:"business_license"}},[t("el-input",{model:{value:s.businessAuth.business_license,callback:function(e){s.$set(s.businessAuth,"business_license",e)},expression:"businessAuth.business_license"}})],1):s._e(),s._v(" "),t("div",{staticStyle:{color:"red",margin:"10px 0 20px 20px"}},[t("span",[s._v("请严格依次选择 1.身份证背面照 》 2.身份证正面照 》 3."+s._s("1"==this.businessAuth.auth_type?"实体店营业执照":"支付宝实名认证照"))])]),s._v(" "),t("div",{staticStyle:{display:"flex","flex-direction":"row"}},[t("el-form-item",{attrs:{label:"图片",prop:"imgs"}},[t("el-upload",{attrs:{action:s._uploadFilePath,"list-type":"picture-card",limit:3,"file-list":s.customer.imgs,"on-remove":s.handleRemoveImg,"on-success":s.handleAvatarScucess,"before-upload":s.beforeAvatarUpload}},[t("i",{staticClass:"el-icon-plus"})])],1)],1)],1),s._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(e){s.$emit("update:showDialog",!1)}}},[s._v("取 消")]),s._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:s.onSubmit}},[s._v("确 定")])],1)],1)},n=[],a={render:i,staticRenderFns:n};e.a=a},"bRJ/":function(s,e,t){"use strict";var i=t("BO1k"),n=t.n(i),a=t("woOf"),r=t.n(a),o=t("Dd8w"),l=t.n(o),u=t("g7ZD"),d=t("JaHG"),c=t("+UIE"),p=t("NYxO"),h=t("Wxq9");t.n(h);e.a={components:{},name:"customerAddOrEdit",props:["showDialog","editRowId"],mounted:function(){this.getTypes(),this.show(),this.getAllSaleUserInfo()},data:function(){return{isAddKeywordsShow:!1,addKeywords:"",resetForm:{id:"",name:"",types:[],fruit_type:"",keywords:[],produceArea:[],sort:999,brand:"",recommendTypes:[],measure_unit:"",status:1,fresh_time:"",fruit_des:"",store_way:"",imgs:[]},businessInfo:{id:"",business_name:"",business_contacts:" ",phone:"",address_province:"",address_city:"",address_detail:"",address_shop:"",shipments_type:0},businessAuth:{id:"",legal_person_name:"",identity:"",bank_account:"",business_license:"",img_identity_front:"",img_identity_reverse:"",img_online_shop:"",img_license:"",auth_type:"1"},businessAuthExt:{businessAuthExtID:0},allSaleUserInfo:{},saleUser:{saleUserId:"请选择"},customer:{},provinceAndCityData:h.provinceAndCityData,provinceAndCityArray:[],provinceAndCityArrayRevert:[],rules:{business_name:[{required:!0,message:"请输入店铺名",trigger:"blur"},{min:2,max:10,message:"长度在 2 到10 个字符之间"}],business_contacts:[{required:!0,message:"请输入联系人",trigger:"blur"},{min:2,max:10,message:"长度在 2 到10 个字符之间"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{validator:function(s,e,t){!1===/^1[34578]\d{9}$/.test(e)?t(new Error("请输入正确的手机号")):t()},trigger:"blur"}],saleUserId:[],provinceAndCityArray:[],address_detail:[{required:!0,message:"请输入详细地址",trigger:"blur"},{max:50,message:"详细地址最多50个字符"}],address_shop:[{required:!1},{max:50,message:"详细地址最多50个字符"}]}}},computed:Object(p.c)({customerStore:"customer"}),methods:l()({deleteKeywords:function(s){this.customer.keywords.splice(this.customer.keywords.indexOf(s),1)},handleKeywordsConfirm:function(){var s=this.addKeywords;s&&this.customer.keywords.push(s),this.isAddKeywordsShow=!1,this.addKeywords=""},showAddKeywords:function(){var s=this;this.isAddKeywordsShow=!0,this.$nextTick(function(e){s.$refs.addKeywordsInput.$refs.input.focus()})},handleRemoveImg:function(s,e){this._imgUploadChange(e)},reset:function(){this.$refs.form&&this.$refs.form.resetFields(),this.customer=r()({},this.resetForm)}},Object(p.b)({getTypes:c.f}),{show:function(){var s=this;this.reset();var e=this;null!==this.editRowId&&this.$http.post("/manage/customer/info",{id:this.editRowId},{showLoading:!0}).then(function(s){var t=s.data.businessAuth,i=s.data.businessInfo;e.businessInfo=i,e.businessAuth=s.data.businessAuth,e.businessAuth.id=t.id,e.saleUser.saleUserId=s.data.saleUser.id,e.provinceAndCityArrayRevert[0]=h.TextToCode[i.address_province].code,e.provinceAndCityArrayRevert[1]=h.TextToCode[i.address_province][i.address_city].code,e.provinceAndCityArray=e.provinceAndCityArrayRevert;var n=[];n.push({url:t.img_identity_reverse}),n.push({url:t.img_identity_front}),null===t.img_license||""===t.img_license?n.push({url:t.img_online_shop}):n.push({url:t.img_license}),e.customer=r()({},Object(d.c)(s.data),{imgs:n})}).catch(function(){s.$emit("update:showDialog",!0)})},getAllSaleUserInfo:function(){var s=this;this.$http.post("/manage/customer/getAllSaleUser").then(function(e){s.allSaleUserInfo=e.data})},handleAvatarScucess:function(s,e,t){s?this._imgUploadChange(t):this.$message.error("该图片不支持上传，请更换一张！")},beforeAvatarUpload:function(s){var e=0===s.type.indexOf("image/");e||this.$message.error("上传图标必须为图片格式!");var t=s.size/1024/1024<5;return t||this.$message.error("上传图标大小不能超过 5MB!"),t&&e},_imgUploadChange:function(s){this.customer.imgs=[];var e=!0,t=!1,i=void 0;try{for(var a,r=n()(s);!(e=(a=r.next()).done);e=!0){var o=a.value;this.customer.imgs.push({url:null!=o.response?this._downloadFilePath+o.response:o.url})}}catch(s){t=!0,i=s}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}},warningMsg:function(s){this.$message({message:s,type:"warning"})},submitBefore:function(){var s=!0;return""===this.businessInfo.address_province&&""===this.businessInfo.address_city?(this.warningMsg("请选择省份"),s=!1):"请选择"===this.saleUser.saleUserId?(this.warningMsg("请选择销售人员"),s=!1):/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(this.businessAuth.identity)?this.businessAuth.bank_account.length>20?(s=!1,this.warningMsg("输入的银行卡号有误"+this.businessAuth.bank_account.length)):(void 0===this.businessAuth.business_license||this.businessAuth.business_license.length>15)&&(s=!1,this.warningMsg("输入的营业执照号有误"+this.businessAuth.business_license.length)):(s=!1,this.warningMsg("输入身份证号码有误")),null!==this.businessInfo.address_shop&&""!==this.businessInfo.address_shop||(this.businessInfo.address_shop=this.businessInfo.address_detail),s},onSubmit:function(){var s=this;this.submitBefore()&&(""===this.businessInfo.address_shop&&(this.businessInfo.address_shop=this.businessInfo.address_detail),this.$refs.form.validate(function(e){if(!e)return!1;var t=[],i=0;s.businessAuthExt.businessAuthExtID=s.businessAuth.id;var a=!0,o=!1,l=void 0;try{for(var d,c=n()(s.customer.imgs);!(a=(d=c.next()).done);a=!0){var p=d.value;0===i?s.businessAuth.img_identity_reverse=p.url:1===i?s.businessAuth.img_identity_front=p.url:2===i&&("1"===s.businessAuth.auth_type?s.businessAuth.img_license=p.url:s.businessAuth.img_online_shop=p.url),i++,t.push(p.url)}}catch(s){o=!0,l=s}finally{try{!a&&c.return&&c.return()}finally{if(o)throw l}}if(t.length<3)return s.warningMsg("请选择严格依次三张图片"),!1;s.$http.post("/manage/customer/getBusinessUserByPhone",s.businessInfo).then(function(e){var t=!1;if(""===s.businessInfo.id&&null!==e.data&&(s.warningMsg("商户联系电话已存在！"),t=!0),!t){var i=r()(s.businessAuth,s.businessInfo,s.saleUser,s.businessAuthExt);s.$http.post("/manage/customer/save",i,{showLoading:!0}).then(function(e){s.$emit("update:showDialog",!1),""!==s.businessInfo.id?(s.$message({type:"success",message:"编辑数据成功"}),u.c.$emit(u.b.edit,i)):(s.$message({type:"success",message:"添加数据成功"}),u.c.$emit(u.b.add,i))})}})}))},handleChangePriovinceAndCityData:function(){this.businessInfo.address_province=h.CodeToText[this.provinceAndCityArray[0]],this.businessInfo.address_city=h.CodeToText[this.provinceAndCityArray[1]]}})}},k1I7:function(s,e,t){e=s.exports=t("FZ+f")(!1),e.push([s.i,".el-cascader,.el-select{width:100%}.input-new-tag.el-input{width:auto}span.el-tag{margin-right:10px}.el-upload--picture-card,.el-upload-list--picture-card .el-upload-list__item{width:150px;height:150px}.el-upload--picture-card{line-height:150px}",""])},xg1Q:function(s,e,t){var i=t("Kp6b");"string"==typeof i&&(i=[[s.i,i,""]]),i.locals&&(s.exports=i.locals);t("rjj0")("77375ecf",i,!0)}});