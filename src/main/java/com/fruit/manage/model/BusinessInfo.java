package com.fruit.manage.model;

import com.fruit.manage.model.base.BaseBusinessInfo;
import com.jfinal.kit.StrKit;
import com.jfinal.plugin.activerecord.Page;
import org.apache.commons.lang3.ArrayUtils;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
public class BusinessInfo extends BaseBusinessInfo<BusinessInfo> {
    public static final BusinessInfo dao = new BusinessInfo().dao();

    public Page<BusinessInfo> getData(String searchProvince,String searchCity,String salesName,String business_name,String[] createTime,int pageNum, int pageSize, String orderBy, boolean isASC) {
        ArrayList<Object> params = new ArrayList<Object>();
        StringBuffer sql = new StringBuffer();
        String select = "SELECT buser.id,buser.phone,binfo.business_name,binfo.address_province,binfo.address_city,binfo.address_shop,binfo.address_detail,auser.`name` AS sales_name,auser.phone AS asles_phone,buser.create_time ";
        sql.append("FROM a_user auser JOIN b_business_user buser ON buser.a_user_sales_id = auser.id JOIN b_business_info binfo ON binfo.u_id = buser.id WHERE 1 = 1 ");
        String noStr = "全部";
        if (StrKit.notBlank(searchProvince) && !searchProvince.equals(noStr)) {
            sql.append("and binfo.address_province = ? ");
            params.add(searchProvince);
        }
        if (StrKit.notBlank(searchCity) && !searchCity.equals(noStr)) {
            sql.append("and binfo.address_city = ? ");
            params.add(searchCity);
        }
        if (StrKit.notBlank(salesName)) {
            sql.append("and auser.`name` LIKE ? ");
            params.add("%"+salesName+"%");
        }
        if (StrKit.notBlank(business_name)) {
            sql.append("and binfo.business_name LIKE ? ");
            params.add("%"+business_name+"%");
        }
        if(ArrayUtils.isNotEmpty(createTime) && createTime.length == 2){
            sql.append("and buser.create_time BETWEEN ? and ? ");
            params.add(createTime[0] + " 00:00:00");
            params.add(createTime[1] + " 23:59:59");
        }
        orderBy = StrKit.isBlank(orderBy) ? "sort" : orderBy;
        sql.append("ORDER BY " + orderBy + " " + (isASC ? "" : "DESC "));
        System.out.println("sql:" + sql.toString());
        return paginate(pageNum, pageSize, select, sql.toString(),params.toArray());
    }
}
